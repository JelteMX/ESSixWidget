{"version":3,"sources":["../src/EsSixWidget/widget/EsSixWidget.js"],"names":[],"mappings":"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","file":"dist.js","sourcesContent":["import declare from 'dojo/_base/declare'\r\nimport _WidgetBase from 'dijit/_WidgetBase'\r\nimport _TemplatedMixin from 'dijit/_TemplatedMixin'\r\nimport dojoEvent from 'dojo/_base/event'\r\nimport dojoStyle from 'dojo/dom-style'\r\nimport dojoHtml from  'dojo/html'\r\nimport dojoConstruct from 'dojo/dom-construct'\r\nimport _jQuery from 'EsSixWidget/lib/jquery-1.11.2'\r\nimport template from 'dojo/text!EsSixWidget/widget/template/EsSixWidget.html'\r\n\r\nconst $ = _jQuery.noConflict()\r\nexport default declare(\"EsSixWidget.widget.EsSixWidget\", [_WidgetBase, _TemplatedMixin], {\r\n    templateString: template,\r\n\r\n    // DOM elements\r\n    inputNodes: null,\r\n    colorSelectNode: null,\r\n    colorInputNode: null,\r\n    infoTextNode: null,\r\n\r\n    // Parameters configured in the Modeler.\r\n    mfToExecute: \"\",\r\n    messageString: \"\",\r\n    backgroundColor: \"\",\r\n\r\n    // Internal variables.\r\n    _handles: null,\r\n    _contextObj: null,\r\n    _alertDiv: null,\r\n    _readOnly: false,\r\n\r\n    constructor() {\r\n        this._handles = []\r\n    },\r\n\r\n    postCreate() {\r\n        logger.debug(this.id + \".postCreate\")\r\n\r\n        if (this.readOnly || this.get(\"disabled\") || this.readonly)\r\n            this._readOnly = true\r\n\r\n        this._updateRendering()\r\n        this._setupEvents()\r\n    },\r\n\r\n    update(obj, callback) {\r\n        logger.debug(this.id + \".update\")\r\n\r\n        this._contextObj = obj\r\n        this._resetSubscriptions()\r\n        this._updateRendering(callback)\r\n    },\r\n\r\n    enable() {\r\n        logger.debug(this.id + \".enable\")\r\n    },\r\n\r\n    disable() {\r\n        logger.debug(this.id + \".disable\")\r\n    },\r\n\r\n    resize() {\r\n        logger.debug(this.id + \".resize\")\r\n    },\r\n\r\n    uninitialize() {\r\n        logger.debug(this.id + \".uninitialize\")\r\n    },\r\n\r\n    // Rerender the interface.\r\n    _updateRendering(callback) {\r\n        logger.debug(this.id + \"._updateRendering\")\r\n        this.colorSelectNode.disabled = this._readOnly\r\n        this.colorInputNode.disabled = this._readOnly\r\n\r\n        if (this._contextObj !== null) {\r\n            dojoStyle.set(this.domNode, \"display\", \"block\")\r\n\r\n            var colorValue = this._contextObj.get(this.backgroundColor)\r\n\r\n            this.colorInputNode.value = colorValue\r\n            this.colorSelectNode.value = colorValue\r\n\r\n            dojoHtml.set(this.infoTextNode, this.messageString)\r\n            dojoStyle.set(this.infoTextNode, \"background-color\", colorValue)\r\n        } else {\r\n            dojoStyle.set(this.domNode, \"display\", \"none\")\r\n        }\r\n\r\n        this._clearValidations()\r\n\r\n        mendix.lang.nullExec(callback)\r\n    },\r\n\r\n    _stopBubblingEventOnMobile(e) {\r\n        logger.debug(this.id + \"._stopBubblingEventOnMobile\")\r\n        if (typeof document.ontouchstart !== \"undefined\") {\r\n            dojoEvent.stop(e)\r\n        }\r\n    },\r\n\r\n    _setupEvents() {\r\n        logger.debug(this.id + \"._setupEvents\")\r\n        this.connect(this.colorSelectNode, \"change\", (e) => {\r\n            this._contextObj.set(this.backgroundColor, this.colorSelectNode.value)\r\n        })\r\n\r\n        this.connect(this.infoTextNode, \"click\", (e) => {\r\n            this._stopBubblingEventOnMobile(e)\r\n\r\n            if (this.mfToExecute !== \"\") {\r\n                mx.data.action({\r\n                    params: {\r\n                        applyto: \"selection\",\r\n                        actionname: this.mfToExecute,\r\n                        guids: [ this._contextObj.getGuid() ]\r\n                    },\r\n                    store: {\r\n                        caller: this.mxform\r\n                    },\r\n                    callback(obj) {\r\n                        //TODO what to do when all is ok!\r\n                    },\r\n                    error: (error) => {\r\n                        logger.error(this.id + \": An error occurred while executing microflow: \" + error.description)\r\n                    }\r\n                }, this)\r\n            }\r\n        })\r\n    },\r\n\r\n    _handleValidation(validations) {\r\n        logger.debug(this.id + \"._handleValidation\")\r\n        this._clearValidations()\r\n\r\n        var validation = validations[0],\r\n            message = validation.getReasonByAttribute(this.backgroundColor)\r\n\r\n        if (this._readOnly) {\r\n            validation.removeAttribute(this.backgroundColor)\r\n        } else if (message) {\r\n            this._addValidation(message)\r\n            validation.removeAttribute(this.backgroundColor)\r\n        }\r\n    },\r\n\r\n    _clearValidations() {\r\n        logger.debug(this.id + \"._clearValidations\")\r\n        dojoConstruct.destroy(this._alertDiv)\r\n        this._alertDiv = null\r\n    },\r\n\r\n    _showError(message) {\r\n        logger.debug(this.id + \"._showError\")\r\n        if (this._alertDiv !== null) {\r\n            dojoHtml.set(this._alertDiv, message)\r\n            return true\r\n        }\r\n        this._alertDiv = dojoConstruct.create(\"div\", {\r\n            \"class\": \"alert alert-danger\",\r\n            \"innerHTML\": message\r\n        })\r\n        dojoConstruct.place(this._alertDiv, this.domNode)\r\n    },\r\n\r\n    _addValidation(message) {\r\n        logger.debug(this.id + \"._addValidation\")\r\n        this._showError(message)\r\n    },\r\n\r\n    _unsubscribe() {\r\n      if (this._handles) {\r\n          for (var handle of this._handles){\r\n              mx.data.unsubscribe(handle)\r\n          }\r\n\r\n          this._handles = []\r\n      }\r\n    },\r\n\r\n    _resetSubscriptions() {\r\n        logger.debug(this.id + \"._resetSubscriptions\")\r\n\r\n        this._unsubscribe()\r\n\r\n        if (this._contextObj) {\r\n            var objectHandle = mx.data.subscribe({\r\n                guid: this._contextObj.getGuid(),\r\n                callback: (guid) => {\r\n                    this._updateRendering()\r\n                }\r\n            })\r\n\r\n            var attrHandle = mx.data.subscribe({\r\n                guid: this._contextObj.getGuid(),\r\n                attr: this.backgroundColor,\r\n                callback: (guid, attr, attrValue) => {\r\n                    this._updateRendering()\r\n                }\r\n            })\r\n\r\n            var validationHandle = mx.data.subscribe({\r\n                guid: this._contextObj.getGuid(),\r\n                val: true,\r\n                callback: () => this._handleValidation\r\n            })\r\n\r\n            this._handles = [ objectHandle, attrHandle, validationHandle ]\r\n        }\r\n    }\r\n\r\n})\r\n\r\nrequire([\"EsSixWidget/widget/EsSixWidget\"])\r\n"]}